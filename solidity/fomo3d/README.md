# FoMo3D 合约完整分析

合约地址: https://etherscan.io/address/0xA62142888ABa8370742bE823c1782D17A0389Da1

## 🎮 合约概述

**合约名称**: FoMo3D (Fear of Missing Out 3D)  
**发布时间**: 2018年7月  
**Solidity 版本**: 0.4.24  
**官网**: https://exitscam.me (已失效)

## ⚠️ 警告：这是一个极其危险的博彩游戏！

FoMo3D 在 2018 年引起巨大轰动，吸引了数千万美元，最终因为漏洞和博弈论问题导致大量用户损失。

## 🎯 游戏机制

### 核心玩法：倒计时炸弹游戏

```
1. 游戏开始，倒计时 24 小时
   ↓
2. 玩家用 ETH 购买 "Keys"（钥匙）
   ↓
3. 每次购买都会：
   - 延长倒计时 30 秒
   - 将你设为"最后买家"
   ↓
4. 当倒计时归零时：
   - 最后买家赢得大奖池（约 48%）
   - 游戏结束，开始新一轮
```

**简单来说**：最后一个买入的人，如果之后 24 小时内没人买，就赢得大奖！

## 📊 关键参数

```solidity
// 初始倒计时
uint256 constant private rndInit_ = 1 hours;

// 每购买一个完整的 Key，增加 30 秒
uint256 constant private rndInc_ = 30 seconds;

// 最大倒计时：24 小时
uint256 constant private rndMax_ = 24 hours;
```

## 💰 资金分配

### 买入时的手续费分配

每次买入会收取费用，分配给多个部分：

```solidity
// 4个团队选择，分配比例不同
// Team 0 - Whales（鲸鱼）
fees_[0] = F3Ddatasets.TeamFee(30,6);   
// 50% → 奖池, 10% → 推荐人, 2% → 社区, 1% → P3D, 1% → 空投

// Team 1 - Bears（熊）
fees_[1] = F3Ddatasets.TeamFee(43,0);
// 43% → 奖池, 10% → 推荐人, 2% → 社区, 1% → P3D, 1% → 空投

// Team 2 - Sneks（蛇）
fees_[2] = F3Ddatasets.TeamFee(56,10);
// 20% → 奖池, 10% → 推荐人, 2% → 社区, 1% → P3D, 1% → 空投

// Team 3 - Bulls（牛）
fees_[3] = F3Ddatasets.TeamFee(43,8);
// 35% → 奖池, 10% → 推荐人, 2% → 社区, 1% → P3D, 1% → 空投
```

### 奖池分配（游戏结束时）

```solidity
// 最后买家（赢家）获得约 48% 的奖池
// 25% 或更少进入下一轮
// 2% 给社区
// 其余分配给所有 Key 持有者
```

## 🎲 四个团队策略

玩家可以选择加入不同的团队，影响资金分配：

| 团队 | 特点 | 进入奖池比例 | 分红比例 | 策略 |
|-----|------|------------|---------|------|
| 🐋 **Whales** | 平衡型 | 50% | 30% → 持有人 | 均衡收益 |
| 🐻 **Bears** | 激进型 | 43% | 43% → 持有人 | 高分红 |
| 🐍 **Sneks** | 保守型 | 20% | 56% → 持有人 | 最高分红 |
| 🐂 **Bulls** | 攻击型 | 35% | 43% → 持有人 | 冲击大奖 |

**选择逻辑**：
- 想冲大奖 → 选 Whales 或 Bulls（更多进奖池）
- 想稳定分红 → 选 Sneks（最高分红比例）

## 🎁 空投机制

```solidity
uint256 public airDropPot_;              // 空投奖池
uint256 public airDropTracker_ = 0;      // 空投计数器
```

**随机空投**：
- 每笔符合条件的交易都可能触发空投
- 概率性获得空投奖池中的 ETH
- 增加游戏的刺激性

## 🔒 安全机制

### 1. 防止合约调用

```solidity
modifier isHuman() {
    address _addr = msg.sender;
    uint256 _codeLength;
    
    assembly {_codeLength := extcodesize(_addr)}
    require(_codeLength == 0, "sorry humans only");
    _;
}
```

**目的**：防止智能合约机器人操纵游戏

**但是**：这个防护[可以绕过](COMMENT.md#extcodesize-extcodesize漏洞)！

### 2. 限制单笔金额

```solidity
modifier isWithinLimits(uint256 _eth) {
    require(_eth >= 1000000000, "pocket lint: not a valid currency");
    require(_eth <= 100000000000000000000000, "no vitalik, no");
    _;    
}
```

**范围**：
- 最小：0.000000001 ETH
- 最大：100,000 ETH

## 🎯 游戏流程示例

### 场景演示

```
时间 0:00 - Alice 买入 10 ETH 的 Keys
  ├─ Alice 成为"最后买家"
  ├─ 倒计时：24小时
  └─ 奖池增加：约 5 ETH

时间 12:00 - Bob 买入 20 ETH 的 Keys
  ├─ Bob 成为"最后买家"（取代 Alice）
  ├─ 倒计时：重置为 24小时
  └─ 奖池增加：约 10 ETH

时间 23:30 - Charlie 买入 5 ETH 的 Keys
  ├─ Charlie 成为"最后买家"
  ├─ 倒计时：重置为 24小时
  └─ 奖池增加：约 2.5 ETH

时间 47:30 - 倒计时结束（没人再买）
  ├─ Charlie 赢得大奖（约 48% 的奖池）
  ├─ Alice 和 Bob 获得分红（按 Key 数量比例）
  └─ 新一轮游戏开始
```

## 💡 博弈论分析

### 纳什均衡问题

这是一个**动态博弈**：

```
如果你相信没人会再买 → 你应该买（成为赢家）
如果大家都这么想 → 游戏会持续下去
如果大家都不买 → 最后买家赢得大奖
```

**问题**：在接近结束时，没人愿意买（怕不是最后一个）

### 鲸鱼策略

大户可以通过以下方式操纵：

```
1. 等到倒计时快结束
2. 用大量 ETH 买入
3. 垄断"最后买家"位置
4. 其他小玩家无力竞争
```

## 🐛 实际发生的漏洞和问题

### 1. 阻塞攻击（Block Stuffing）

**2018年真实发生**：

```
攻击者在倒计时快结束时：
1. 发送大量高 Gas 的交易填满区块
2. 导致其他人无法在时间内买入
3. 确保自己成为最后买家
4. 赢得 1000+ ETH 大奖
```

**影响**：第一轮游戏就被攻击，赢家通过阻塞攻击获胜

### 2. isHuman() 防护被绕过

```solidity
// 原本想阻止合约调用
modifier isHuman() {
    uint256 _codeLength;
    assembly {_codeLength := extcodesize(_addr)}
    require(_codeLength == 0, "sorry humans only");
    _;
}
```

**绕过方法**：
- 在合约的 `constructor` 中调用（此时 codesize 为 0）
- 使用代理合约模式

### 3. 前端跑路（Exit Scam）

官网域名：`exitscam.me`

**讽刺的是**：
- 网站名字就叫"退出骗局"
- 游戏结束后团队真的跑路了
- 这算是"诚实的骗局"吗？😅

## 📊 历史数据

### 第一轮游戏统计

```
持续时间: 约 3 个月
总投入: 约 30,000 ETH（当时价值 $1000万+）
最终奖池: 约 10,000 ETH
赢家: 0xa169DF5ED3363cfC4c92ac96C6C5f2A42fCCBF85
赢得: 约 10,469 ETH（$300万+）
方法: 区块阻塞攻击
```

### 其他轮次

- 后续轮次参与度大幅下降
- 玩家意识到游戏的风险
- 多数人亏损

## 🎓 代码结构

### 主要合约

```solidity
contract F3Devents {
    // 定义所有事件
    event onNewName(...);
    event onEndTx(...);
    event onWithdraw(...);
    // ... 更多事件
}

contract modularLong is F3Devents {
    // 主游戏逻辑
    
    // 核心状态
    uint256 public rID_;                    // 当前回合 ID
    uint256 public airDropPot_;             // 空投奖池
    mapping (uint256 => F3Ddatasets.Round) public round_;  // 回合数据
    
    // 核心函数
    function buy()              // 购买 Keys
    function withdraw()         // 提取收益
    function registerNameXID()  // 注册名字
    // ... 更多函数
}
```

### 数据结构

```solidity
struct Round {
    uint256 plyr;       // 当前领先者的玩家 ID
    uint256 end;        // 回合结束时间戳
    uint256 strt;       // 回合开始时间
    uint256 keys;       // 本轮总 Keys
    uint256 eth;        // 本轮总 ETH
    uint256 pot;        // 当前奖池金额
    uint256 mask;       // 分红掩码（用于计算收益）
    // ... 更多字段
}
```

## ⚠️ 风险总结

### 🚨 极高风险

1. **大概率亏损**
   ```
   除了最后赢家，大多数人亏损
   手续费极高（每次买卖都扣费）
   ```

2. **可被操纵**
   ```
   鲸鱼可以通过资金优势控制游戏
   阻塞攻击可以确保获胜
   ```

3. **流动性风险**
   ```
   Key 的价格会波动
   卖出时可能大幅损失
   ```

4. **时间成本**
   ```
   游戏可能持续数月
   资金被长期锁定
   ```

5. **归零风险**
   ```
   如果游戏停止，持有的 Key 可能归零
   没有保底机制
   ```

## 🎯 与 PoWH3D 对比

| 特性 | PoWH3D | FoMo3D |
|-----|--------|--------|
| **类型** | 金字塔/分红游戏 | 倒计时博彩游戏 |
| **机制** | 买卖代币，持续分红 | 购买 Keys，等待倒计时 |
| **赢家** | 早期进入者 | 最后买家 |
| **持续性** | 可以一直玩 | 一轮一轮进行 |
| **风险** | 高（庞氏） | 极高（博彩+庞氏） |
| **复杂度** | 中等 | 非常高 |
| **手续费** | 10% 买卖 | 变化（20-60%） |

## 💭 设计者的"艺术"

### 讽刺性设计

1. **域名**：`exitscam.me`（退出骗局）
   - 开发者明确告诉你这是骗局
   - 但玩家还是参与了

2. **警告**：
   ```
   WARNING: THIS PRODUCT IS HIGHLY ADDICTIVE. 
   IF YOU HAVE AN ADDICTIVE NATURE. DO NOT PLAY.
   ```

3. **团队名字**：都是加密圈的梗
   - Sumpunk（著名审计员）
   - Inventor（P3D 开发者）

**哲学思考**：
> 如果开发者明确告诉你这是骗局，你还参与了，这算欺诈吗？

## 📚 学习价值

### 技术角度

✅ **值得学习的地方**：
1. 复杂的状态管理
2. Gas 优化技巧
3. 事件驱动架构
4. 模块化设计
5. [巧妙的 Mask 算法的分红机制设计](COMMENT.md#fomo3d-分红机制%20-%20Mask算法)

### 经济学角度

✅ **研究价值**：
1. 博弈论实践案例
2. 激励机制设计
3. 人性与贪婪
4. 加密货币社会实验

### 安全角度

✅ **反面教材**：
1. 如何不设计博彩合约
2. 区块链游戏的漏洞
3. 防护机制的局限性

## 🎬 总结

### FoMo3D 本质

```
FoMo3D = 倒计时炸弹 + 金字塔 + 博彩 + 分红

设计目标: 利用人们的 FOMO 心理
实际结果: 大多数人亏损，少数人暴富
社会影响: 暴露了加密货币的投机本质
```

### 教训

1. **不要参与明显的博彩游戏**
2. **FOMO（错失恐惧）是最危险的心理**
3. **即使规则公开，也可能被操纵**
4. **"去中心化"不等于"公平"**
5. **高收益必然伴随高风险**

## ⚠️ 最终警告

**这个合约仅供学习研究！**

- 🚫 不要部署类似的合约
- 🚫 不要参与此类游戏
- 🚫 不要用真钱测试
- 🚫 在大多数国家这是非法的

**记住**：

> The house always wins.  
> （庄家永远赢）

在 FoMo3D 中，"庄家"可能是：
- 鲸鱼大户
- 懂技术的攻击者
- 或者运气极好的人

**但绝对不会是你！**

---

*本文档仅供教育目的。参与此类项目可能违法，并必然导致财务损失。*

